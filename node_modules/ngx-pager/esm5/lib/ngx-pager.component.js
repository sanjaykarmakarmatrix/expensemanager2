/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { Router, ActivatedRoute } from '@angular/router';
var NgxPagerComponent = /** @class */ (function () {
    /* Function Name : constructor
      * Author :
      * Created Date : 06-03-2019
      * Modified Date : *
      * Purpose : to define the all helpful objects and defin the languages data
      * PARAMS : cService, modalService, translate
      */
    function NgxPagerComponent(route, activeRoute) {
        this.route = route;
        this.activeRoute = activeRoute;
        this.config = null; // set the config
        // set the config
        this.totalrow = null;
        // @Output('page') page = new EventEmitter();
        this.pages = []; // get pages
        // get pages
        this.currentPage = 1; // for current page no
        // for current page no
        this.displayPagesCount = 3; // set no of display page 
        // set no of display page 
        this.totalPage = 1; // get the total page
        // get the total page
        this.simple = false; // to set only next and prev link
        // to set only next and prev link
        this.firstLastView = false; // to set that last first button will display or not
        // to set that last first button will display or not
        this.error = false;
        this.redirectType = '';
        this.redirectParamName = '';
        this.customContent = {
            "prev": "&#10094;",
            "next": "&#x276F;",
            "first": "&#10094;&#10094;",
            "last": "&#x276F;&#x276F;",
        };
    }
    /* Function Name : ngOnInit
      * Author :
      * Created Date : 06-03-2019
      * Modified Date : *
      * Purpose : to get data after html load
      * PARAMS :
      */
    /* Function Name : ngOnInit
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to get data after html load
        * PARAMS :
        */
    /**
     * @return {?}
     */
    NgxPagerComponent.prototype.ngOnInit = /* Function Name : ngOnInit
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to get data after html load
        * PARAMS :
        */
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (localStorage.getItem('_nxp') && this.config && !this.config.redirect) {
            /** @type {?} */
            var localUrl = localStorage.getItem('_nxp');
            /** @type {?} */
            var localUrlArr = localUrl.split(":");
            if (localUrlArr[0] == this.route.url) {
                this.currentPage = Number(localUrlArr[1]);
            }
            this.rendering();
        }
        else if (!localStorage.getItem('_nxp') && this.config && !this.config.redirect) {
            localStorage.setItem('_nxp', this.route.url + ':' + this.currentPage);
            this.rendering();
        }
        else if (this.totalrow || this.totalrow == 0) {
            this.error = true;
        }
        else if (this.config && this.config.redirect) {
            localStorage.removeItem("_nxp");
            if (!this.config.redirect.type) {
                console.error("'type' parameter must be set with 'redirect' parameter");
                this.error = true;
                return false;
            }
            if (!this.config.redirect.param) {
                console.error("'param' parameter must be set with 'redirect' parameter");
                this.error = true;
                return false;
            }
            if (!this.error) {
                /** @type {?} */
                var activeRouteObj = null;
                if (this.config.redirect.type === 'q') { // query string
                    activeRouteObj = this.activeRoute.queryParams;
                    this.redirectParamName = this.config.redirect.param;
                }
                else if (this.config.redirect.type === 'p') { // query parameters
                    this.redirectParamName = this.config.redirect.param.name;
                    activeRouteObj = this.activeRoute.params;
                }
                activeRouteObj.subscribe((/**
                 * @param {?} params
                 * @return {?}
                 */
                function (params) {
                    if (params[_this.redirectParamName]) {
                        _this.currentPage = parseInt(params[_this.redirectParamName]);
                    }
                    _this.rendering();
                }));
            }
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    NgxPagerComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.totalrow && this.totalrow) {
            this.settings();
        }
    };
    /**
     * @return {?}
     */
    NgxPagerComponent.prototype.settings = /**
     * @return {?}
     */
    function () {
        if (this.config) {
            if (this.config.firstLastView) {
                this.firstLastView = this.config.firstLastView;
            }
            if (this.config.simple) {
                this.simple = this.config.simple;
            }
            if (this.config.displayPageCount) {
                this.displayPagesCount = this.config.displayPageCount;
            }
            if (this.config.customContent) {
                if (this.config.customContent.prev) {
                    this.customContent.prev = this.config.customContent.prev;
                }
                if (this.config.customContent.next) {
                    this.customContent.next = this.config.customContent.next;
                }
                if (this.config.customContent.first) {
                    this.customContent.first = this.config.customContent.first;
                }
                if (this.config.customContent.last) {
                    this.customContent.last = this.config.customContent.last;
                }
            }
            if (this.error === false && this.totalrow && this.config.perPage) {
                this.totalPage = this.totalrow / this.config.perPage;
                if (this.totalPage % 1 != 0) {
                    this.totalPage += 1;
                    this.totalPage = Math.floor(this.totalPage);
                }
            }
            else {
                if (!this.totalrow) {
                    console.error("'totalrow' parameter must be set");
                    this.error = true;
                    // return false;
                }
                if (!this.config.perPage) {
                    console.error("'perPage' parameter must be set");
                    this.error = true;
                    // return false;
                }
            }
            if (this.error === false && this.displayPagesCount > this.totalPage) {
                this.displayPagesCount = this.totalPage;
            }
            if (this.error === false) {
                this.redefinePager();
            }
        }
        else {
            console.error("define 'config' parameters of ngx-pager");
            this.error = true;
            return false;
        }
    };
    /* Function Name : pageClick
      * Author :
      * Created Date : 06-03-2019
      * Modified Date : *
      * Purpose : event for click on page
      * PARAMS : pageNo
      */
    /* Function Name : pageClick
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : event for click on page
        * PARAMS : pageNo
        */
    /**
     * @param {?} event
     * @param {?} pageNo
     * @return {?}
     */
    NgxPagerComponent.prototype.pageClick = /* Function Name : pageClick
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : event for click on page
        * PARAMS : pageNo
        */
    /**
     * @param {?} event
     * @param {?} pageNo
     * @return {?}
     */
    function (event, pageNo) {
        this.currentPage = pageNo;
        this.redefinePager();
        if (!this.config.redirect) {
            localStorage.setItem('_nxp', this.route.url + ':' + this.currentPage);
            this.rendering();
        }
        else {
            /** @type {?} */
            var navigateConfig = {
                relativeTo: this.activeRoute
            };
            if (this.config.redirect.type === 'q') {
                navigateConfig['queryParams'] = {};
                navigateConfig['queryParams'][this.redirectParamName] = this.currentPage;
                navigateConfig['queryParamsHandling'] = 'merge';
                this.route.navigate([], navigateConfig);
            }
            else if (this.config.redirect.type === 'p') {
                if (this.config.redirect.param.path) {
                    /** @type {?} */
                    var navigate = [this.config.redirect.param.path];
                    for (var p in this.config.redirect.param.params) {
                        if (p === this.redirectParamName) {
                            navigate.push(this.currentPage);
                        }
                        else {
                            navigate.push(this.config.redirect.param.params[p]);
                        }
                    }
                    this.route.navigate(navigate);
                }
                else {
                    console.error("'url' parameter must be set with 'config.redirect'");
                    this.error = true;
                    return false;
                }
            }
        }
    };
    /* Function Name : redefinePager
      * Author :
      * Created Date : 06-03-2019
      * Modified Date : *
      * Purpose : to create pagination html
      * PARAMS :
      */
    /* Function Name : redefinePager
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to create pagination html
        * PARAMS :
        */
    /**
     * @return {?}
     */
    NgxPagerComponent.prototype.redefinePager = /* Function Name : redefinePager
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to create pagination html
        * PARAMS :
        */
    /**
     * @return {?}
     */
    function () {
        this.pages = [];
        this.pages.push(this.currentPage);
        /** @type {?} */
        var leftCount = 0;
        /** @type {?} */
        var rightCount = 0;
        if (this.displayPagesCount % 2 == 0) { // if even display number count
            leftCount = Math.floor(this.displayPagesCount / 3); // one thard in left
            rightCount = Math.floor((this.displayPagesCount * 2) / 3); // two thard in right
            if (this.displayPagesCount % 6 == 0) {
                leftCount -= 1;
            }
        }
        else { // if odd display number count 
            leftCount = Math.floor((this.displayPagesCount - 1) / 2); // half in left
            rightCount = Math.floor((this.displayPagesCount - 1) / 2); // half in right
        }
        /** @type {?} */
        var leftArr = [];
        /** @type {?} */
        var rightArr = [];
        for (var p = 1; p <= leftCount; p++) {
            if ((this.currentPage - p) > 0) {
                leftArr.push(this.currentPage - p);
            }
        }
        if (leftArr.length < leftCount) {
            rightCount += leftCount - leftArr.length;
        }
        for (var p = 1; p <= rightCount; p++) {
            if (this.currentPage + p <= this.totalPage) {
                rightArr.push(this.currentPage + p);
            }
        }
        if (rightArr.length < rightCount) {
            leftCount += rightCount - rightArr.length;
            leftArr = [];
            for (var p = 1; p <= leftCount; p++) {
                if ((this.currentPage - p) > 0) {
                    leftArr.push(this.currentPage - p);
                }
            }
        }
        this.pages = this.pages.concat(leftArr);
        this.pages = this.pages.concat(rightArr);
        this.pages.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) { return a - b; }));
    };
    /**
     * @return {?}
     */
    NgxPagerComponent.prototype.rendering = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.config.render(_this.currentPage);
        }), 5);
    };
    NgxPagerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-pager',
                    template: "<div class=\"ngx-pager-container\" *ngIf=\"!error && totalrow > 0\">\n<ul *ngIf=\"pages\">\n    <li class=\"arrow first\" [class.disabled]=\"currentPage==1\" *ngIf=\"firstLastView && !simple\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, 1)\" [innerHTML]=\"customContent.first\"></a></li>\n    \n    <li class=\"arrow prev\" [class.disabled]=\"currentPage==1\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, (currentPage-1))\" [innerHTML]=\"customContent.prev\"></a></li>\n    \n    <li *ngFor=\"let p of pages\" [class.active]=\"currentPage==p\" [class.invisible]=\"simple\">\n    <a  href=\"javascript:void(0)\" (click)=\"pageClick($event, p)\">{{ p }}</a>\n    </li>\n    \n    <li class=\"arrow next\" [class.disabled]=\"currentPage==totalPage\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, currentPage+1)\" [innerHTML]=\"customContent.next\"></a></li>\n    \n    <li class=\"arrow last\" [class.disabled]=\"currentPage==totalPage\" *ngIf=\"firstLastView && !simple\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, totalPage)\" [innerHTML]=\"customContent.last\"></a></li>\n</ul>\n</div>\n",
                    styles: [".ngx-pager-container li.disabled{pointer-events:none;cursor:not-allowed}.ngx-pager-container li.disabled a{color:#cacaca}"]
                }] }
    ];
    /** @nocollapse */
    NgxPagerComponent.ctorParameters = function () { return [
        { type: Router },
        { type: ActivatedRoute }
    ]; };
    NgxPagerComponent.propDecorators = {
        config: [{ type: Input }],
        totalrow: [{ type: Input }]
    };
    return NgxPagerComponent;
}());
export { NgxPagerComponent };
if (false) {
    /** @type {?} */
    NgxPagerComponent.prototype.config;
    /** @type {?} */
    NgxPagerComponent.prototype.totalrow;
    /** @type {?} */
    NgxPagerComponent.prototype.pages;
    /** @type {?} */
    NgxPagerComponent.prototype.currentPage;
    /** @type {?} */
    NgxPagerComponent.prototype.displayPagesCount;
    /** @type {?} */
    NgxPagerComponent.prototype.totalPage;
    /** @type {?} */
    NgxPagerComponent.prototype.simple;
    /** @type {?} */
    NgxPagerComponent.prototype.firstLastView;
    /** @type {?} */
    NgxPagerComponent.prototype.error;
    /** @type {?} */
    NgxPagerComponent.prototype.redirectType;
    /** @type {?} */
    NgxPagerComponent.prototype.redirectParamName;
    /** @type {?} */
    NgxPagerComponent.prototype.customContent;
    /**
     * @type {?}
     * @private
     */
    NgxPagerComponent.prototype.route;
    /**
     * @type {?}
     * @private
     */
    NgxPagerComponent.prototype.activeRoute;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXBhZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1wYWdlci8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtcGFnZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFXLEtBQUssRUFBMEMsTUFBTSxlQUFlLENBQUM7QUFDbEcsT0FBTyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RDtJQTRCRTs7Ozs7O1FBTUM7SUFDRCwyQkFBb0IsS0FBYSxFQUFVLFdBQTJCO1FBQWxELFVBQUssR0FBTCxLQUFLLENBQVE7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUE1QjdELFdBQU0sR0FBUSxJQUFJLENBQUMsQ0FBQyxpQkFBaUI7O1FBQ3JDLGFBQVEsR0FBRyxJQUFJLENBQUM7O1FBRXpCLFVBQUssR0FBZ0IsRUFBRSxDQUFDLENBQUMsWUFBWTs7UUFDckMsZ0JBQVcsR0FBWSxDQUFDLENBQUMsQ0FBQyxzQkFBc0I7O1FBQ2hELHNCQUFpQixHQUFXLENBQUMsQ0FBQyxDQUFDLDBCQUEwQjs7UUFDekQsY0FBUyxHQUFXLENBQUMsQ0FBQyxDQUFDLHFCQUFxQjs7UUFDNUMsV0FBTSxHQUFXLEtBQUssQ0FBQyxDQUFDLGlDQUFpQzs7UUFDekQsa0JBQWEsR0FBWSxLQUFLLENBQUMsQ0FBQyxvREFBb0Q7O1FBQ3BGLFVBQUssR0FBYSxLQUFLLENBQUM7UUFDeEIsaUJBQVksR0FBVyxFQUFFLENBQUM7UUFDMUIsc0JBQWlCLEdBQVcsRUFBRSxDQUFDO1FBRS9CLGtCQUFhLEdBQVE7WUFDbkIsTUFBTSxFQUFDLFVBQVU7WUFDakIsTUFBTSxFQUFDLFVBQVU7WUFDakIsT0FBTyxFQUFDLGtCQUFrQjtZQUMxQixNQUFNLEVBQUMsa0JBQWtCO1NBQzFCLENBQUE7SUFVd0UsQ0FBQztJQUMxRTs7Ozs7O1FBTUM7Ozs7Ozs7Ozs7O0lBQ0Qsb0NBQVE7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OztJQUFUO1FBQUEsaUJBSUM7UUFIQyxVQUFVOzs7UUFBQztZQUNULEtBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN2QyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDOztnQkF2UUYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxXQUFXO29CQUNyQix5b0NBQXdDOztpQkFFekM7Ozs7Z0JBTFEsTUFBTTtnQkFBRSxjQUFjOzs7eUJBUTVCLEtBQUs7MkJBQ0wsS0FBSzs7SUFnUVIsd0JBQUM7Q0FBQSxBQXhRRCxJQXdRQztTQW5RWSxpQkFBaUI7OztJQUU1QixtQ0FBNEI7O0lBQzVCLHFDQUF5Qjs7SUFFekIsa0NBQXdCOztJQUN4Qix3Q0FBeUI7O0lBQ3pCLDhDQUE4Qjs7SUFDOUIsc0NBQXNCOztJQUN0QixtQ0FBdUI7O0lBQ3ZCLDBDQUErQjs7SUFDL0Isa0NBQXdCOztJQUN4Qix5Q0FBMEI7O0lBQzFCLDhDQUErQjs7SUFFL0IsMENBS0M7Ozs7O0lBVVcsa0NBQXFCOzs7OztJQUFFLHdDQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgIE91dHB1dCwgSW5wdXQsIEV2ZW50RW1pdHRlciAsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlc30gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIsIEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1wYWdlcicsXG4gIHRlbXBsYXRlVXJsOicuL25neC1wYWdlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL25neC1wYWdlci5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIE5neFBhZ2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICBASW5wdXQoKSBjb25maWc6IGFueSA9IG51bGw7IC8vIHNldCB0aGUgY29uZmlnXG4gIEBJbnB1dCgpIHRvdGFscm93ID0gbnVsbDtcbiAgLy8gQE91dHB1dCgncGFnZScpIHBhZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHBhZ2VzIDogQXJyYXk8YW55PiA9IFtdOyAvLyBnZXQgcGFnZXNcbiAgY3VycmVudFBhZ2UgOiBudW1iZXIgPSAxOyAvLyBmb3IgY3VycmVudCBwYWdlIG5vXG4gIGRpc3BsYXlQYWdlc0NvdW50OiBudW1iZXIgPSAzOyAvLyBzZXQgbm8gb2YgZGlzcGxheSBwYWdlIFxuICB0b3RhbFBhZ2U6IG51bWJlciA9IDE7IC8vIGdldCB0aGUgdG90YWwgcGFnZVxuICBzaW1wbGU6Ym9vbGVhbiA9IGZhbHNlOyAvLyB0byBzZXQgb25seSBuZXh0IGFuZCBwcmV2IGxpbmtcbiAgZmlyc3RMYXN0VmlldzogYm9vbGVhbiA9IGZhbHNlOyAvLyB0byBzZXQgdGhhdCBsYXN0IGZpcnN0IGJ1dHRvbiB3aWxsIGRpc3BsYXkgb3Igbm90XG4gIGVycm9yIDogYm9vbGVhbiA9IGZhbHNlO1xuICByZWRpcmVjdFR5cGU6IHN0cmluZyA9ICcnO1xuICByZWRpcmVjdFBhcmFtTmFtZTogc3RyaW5nID0gJyc7XG5cbiAgY3VzdG9tQ29udGVudDogYW55ID0ge1xuICAgIFwicHJldlwiOlwiJiMxMDA5NDtcIixcbiAgICBcIm5leHRcIjpcIiYjeDI3NkY7XCIsXG4gICAgXCJmaXJzdFwiOlwiJiMxMDA5NDsmIzEwMDk0O1wiLFxuICAgIFwibGFzdFwiOlwiJiN4Mjc2RjsmI3gyNzZGO1wiLFxuICB9XG5cblxuICAvKiBGdW5jdGlvbiBOYW1lIDogY29uc3RydWN0b3Jcblx0KiBBdXRob3IgOiBcblx0KiBDcmVhdGVkIERhdGUgOiAwNi0wMy0yMDE5IFxuXHQqIE1vZGlmaWVkIERhdGUgOiAqXG5cdCogUHVycG9zZSA6IHRvIGRlZmluZSB0aGUgYWxsIGhlbHBmdWwgb2JqZWN0cyBhbmQgZGVmaW4gdGhlIGxhbmd1YWdlcyBkYXRhXG5cdCogUEFSQU1TIDogY1NlcnZpY2UsIG1vZGFsU2VydmljZSwgdHJhbnNsYXRlXG5cdCovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGU6IFJvdXRlciwgcHJpdmF0ZSBhY3RpdmVSb3V0ZTogQWN0aXZhdGVkUm91dGUpIHt9XG4gIC8qIEZ1bmN0aW9uIE5hbWUgOiBuZ09uSW5pdFxuXHQqIEF1dGhvciA6IFxuXHQqIENyZWF0ZWQgRGF0ZSA6IDA2LTAzLTIwMTkgXG5cdCogTW9kaWZpZWQgRGF0ZSA6ICpcblx0KiBQdXJwb3NlIDogdG8gZ2V0IGRhdGEgYWZ0ZXIgaHRtbCBsb2FkXG5cdCogUEFSQU1TIDogXG5cdCovXG4gIG5nT25Jbml0KCkge1xuICAgIFxuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnX254cCcpICYmIHRoaXMuY29uZmlnICYmICF0aGlzLmNvbmZpZy5yZWRpcmVjdCkge1xuICAgICAgICAgIFxuICAgICAgbGV0IGxvY2FsVXJsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ19ueHAnKTtcbiAgICAgIGxldCBsb2NhbFVybEFyciA9IGxvY2FsVXJsLnNwbGl0KFwiOlwiKTtcbiAgICAgIGlmIChsb2NhbFVybEFyclswXSA9PSB0aGlzLnJvdXRlLnVybCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gTnVtYmVyKGxvY2FsVXJsQXJyWzFdKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVuZGVyaW5nKCk7XG4gICAgfSBcbiAgICBlbHNlIGlmICghbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ19ueHAnKSAmJiB0aGlzLmNvbmZpZyAmJiAhdGhpcy5jb25maWcucmVkaXJlY3QpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdfbnhwJywgdGhpcy5yb3V0ZS51cmwrJzonK3RoaXMuY3VycmVudFBhZ2UpO1xuICAgICAgdGhpcy5yZW5kZXJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy50b3RhbHJvdyB8fCB0aGlzLnRvdGFscm93ID09IDApIHtcbiAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcucmVkaXJlY3Qpe1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJfbnhwXCIpO1xuICAgICAgaWYgKCF0aGlzLmNvbmZpZy5yZWRpcmVjdC50eXBlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCIndHlwZScgcGFyYW1ldGVyIG11c3QgYmUgc2V0IHdpdGggJ3JlZGlyZWN0JyBwYXJhbWV0ZXJcIik7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnJlZGlyZWN0LnBhcmFtKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCIncGFyYW0nIHBhcmFtZXRlciBtdXN0IGJlIHNldCB3aXRoICdyZWRpcmVjdCcgcGFyYW1ldGVyXCIpO1xuICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLmVycm9yKSB7XG4gICAgICAgICAgbGV0IGFjdGl2ZVJvdXRlT2JqID0gIG51bGw7XG4gICAgICAgICAgaWYgKHRoaXMuY29uZmlnLnJlZGlyZWN0LnR5cGUgPT09ICdxJykgeyAvLyBxdWVyeSBzdHJpbmdcbiAgICAgICAgICAgIGFjdGl2ZVJvdXRlT2JqID0gdGhpcy5hY3RpdmVSb3V0ZS5xdWVyeVBhcmFtcztcbiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RQYXJhbU5hbWUgPSB0aGlzLmNvbmZpZy5yZWRpcmVjdC5wYXJhbTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnJlZGlyZWN0LnR5cGUgPT09ICdwJykgeyAvLyBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgICAgICAgICB0aGlzLnJlZGlyZWN0UGFyYW1OYW1lID0gdGhpcy5jb25maWcucmVkaXJlY3QucGFyYW0ubmFtZTtcbiAgICAgICAgICAgIGFjdGl2ZVJvdXRlT2JqID0gdGhpcy5hY3RpdmVSb3V0ZS5wYXJhbXM7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYWN0aXZlUm91dGVPYmouc3Vic2NyaWJlKHBhcmFtcyA9PiB7XG4gICAgICAgICAgICBpZiAocGFyYW1zW3RoaXMucmVkaXJlY3RQYXJhbU5hbWVdKSB7XG4gICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBwYXJzZUludChwYXJhbXNbdGhpcy5yZWRpcmVjdFBhcmFtTmFtZV0pO1xuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIHRoaXMucmVuZGVyaW5nKCk7XG4gICAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9IFxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczpTaW1wbGVDaGFuZ2VzKSB7XG5cbiAgICBpZiAoY2hhbmdlcy50b3RhbHJvdyAmJiB0aGlzLnRvdGFscm93KSAge1xuICAgICAgXG4gICAgICB0aGlzLnNldHRpbmdzKCk7XG4gICAgfVxuICB9XG4gIHNldHRpbmdzKCkge1xuICAgIGlmICh0aGlzLmNvbmZpZykge1xuICAgICAgXG4gICAgICBpZiAodGhpcy5jb25maWcuZmlyc3RMYXN0Vmlldykge1xuICAgICAgICB0aGlzLmZpcnN0TGFzdFZpZXcgPSB0aGlzLmNvbmZpZy5maXJzdExhc3RWaWV3O1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29uZmlnLnNpbXBsZSkge1xuICAgICAgICB0aGlzLnNpbXBsZSA9IHRoaXMuY29uZmlnLnNpbXBsZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5kaXNwbGF5UGFnZUNvdW50KSB7XG4gICAgICAgIHRoaXMuZGlzcGxheVBhZ2VzQ291bnQgPSB0aGlzLmNvbmZpZy5kaXNwbGF5UGFnZUNvdW50O1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jb25maWcuY3VzdG9tQ29udGVudCkge1xuICAgICAgICBpZiAodGhpcy5jb25maWcuY3VzdG9tQ29udGVudC5wcmV2KSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21Db250ZW50LnByZXYgPSB0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50LnByZXY7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmN1c3RvbUNvbnRlbnQubmV4dCkge1xuICAgICAgICAgIHRoaXMuY3VzdG9tQ29udGVudC5uZXh0ID0gdGhpcy5jb25maWcuY3VzdG9tQ29udGVudC5uZXh0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50LmZpcnN0KSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21Db250ZW50LmZpcnN0ID0gdGhpcy5jb25maWcuY3VzdG9tQ29udGVudC5maXJzdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25maWcuY3VzdG9tQ29udGVudC5sYXN0KSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21Db250ZW50Lmxhc3QgPSB0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50Lmxhc3Q7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKHRoaXMuZXJyb3IgPT09IGZhbHNlICYmIHRoaXMudG90YWxyb3cgJiYgdGhpcy5jb25maWcucGVyUGFnZSkge1xuICAgICAgICB0aGlzLnRvdGFsUGFnZSA9IHRoaXMudG90YWxyb3cvdGhpcy5jb25maWcucGVyUGFnZTtcbiAgICAgICAgaWYgKHRoaXMudG90YWxQYWdlJTEgIT0gMCkge1xuICAgICAgICAgIHRoaXMudG90YWxQYWdlICs9MTtcbiAgICAgICAgICB0aGlzLnRvdGFsUGFnZSA9IE1hdGguZmxvb3IodGhpcy50b3RhbFBhZ2UpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIXRoaXMudG90YWxyb3cpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiJ3RvdGFscm93JyBwYXJhbWV0ZXIgbXVzdCBiZSBzZXRcIik7XG4gICAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgICAgLy8gcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5jb25maWcucGVyUGFnZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCIncGVyUGFnZScgcGFyYW1ldGVyIG11c3QgYmUgc2V0XCIpO1xuICAgICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgICAgIC8vIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAodGhpcy5lcnJvciA9PT0gZmFsc2UgJiYgdGhpcy5kaXNwbGF5UGFnZXNDb3VudCA+IHRoaXMudG90YWxQYWdlKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheVBhZ2VzQ291bnQgPSB0aGlzLnRvdGFsUGFnZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmVycm9yID09PSBmYWxzZSkge1xuICAgICAgICB0aGlzLnJlZGVmaW5lUGFnZXIoKTtcbiAgICAgIH1cbiAgICAgXG4gICAgICBcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcihcImRlZmluZSAnY29uZmlnJyBwYXJhbWV0ZXJzIG9mIG5neC1wYWdlclwiKTtcbiAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICAvKiBGdW5jdGlvbiBOYW1lIDogcGFnZUNsaWNrXG5cdCogQXV0aG9yIDogXG5cdCogQ3JlYXRlZCBEYXRlIDogMDYtMDMtMjAxOSBcblx0KiBNb2RpZmllZCBEYXRlIDogKlxuXHQqIFB1cnBvc2UgOiBldmVudCBmb3IgY2xpY2sgb24gcGFnZVxuXHQqIFBBUkFNUyA6IHBhZ2VOb1xuXHQqL1xuICBwYWdlQ2xpY2soZXZlbnQsIHBhZ2VObykge1xuICAgIHRoaXMuY3VycmVudFBhZ2UgPSBwYWdlTm87XG4gICAgdGhpcy5yZWRlZmluZVBhZ2VyKCk7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZWRpcmVjdCkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ19ueHAnLCB0aGlzLnJvdXRlLnVybCsnOicrdGhpcy5jdXJyZW50UGFnZSk7XG4gICAgICB0aGlzLnJlbmRlcmluZygpO1xuICAgICAgXG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBuYXZpZ2F0ZUNvbmZpZyA9IHtcbiAgICAgICAgcmVsYXRpdmVUbzogdGhpcy5hY3RpdmVSb3V0ZVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29uZmlnLnJlZGlyZWN0LnR5cGUgPT09ICdxJykge1xuICAgICAgICBuYXZpZ2F0ZUNvbmZpZ1sncXVlcnlQYXJhbXMnXSA9IHt9O1xuICAgICAgICBuYXZpZ2F0ZUNvbmZpZ1sncXVlcnlQYXJhbXMnXVt0aGlzLnJlZGlyZWN0UGFyYW1OYW1lXSA9IHRoaXMuY3VycmVudFBhZ2U7XG4gICAgICAgIG5hdmlnYXRlQ29uZmlnWydxdWVyeVBhcmFtc0hhbmRsaW5nJ10gPSAnbWVyZ2UnO1xuICAgICAgICB0aGlzLnJvdXRlLm5hdmlnYXRlKFtdLCBuYXZpZ2F0ZUNvbmZpZyk7ICBcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcucmVkaXJlY3QudHlwZSA9PT0gJ3AnKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5yZWRpcmVjdC5wYXJhbS5wYXRoKSB7XG4gICAgICAgICAgbGV0IG5hdmlnYXRlID0gW3RoaXMuY29uZmlnLnJlZGlyZWN0LnBhcmFtLnBhdGhdO1xuICAgICAgICAgIGZvciAobGV0IHAgaW4gdGhpcy5jb25maWcucmVkaXJlY3QucGFyYW0ucGFyYW1zKSB7XG4gICAgICAgICAgICBpZiAocD09PXRoaXMucmVkaXJlY3RQYXJhbU5hbWUpIHtcbiAgICAgICAgICAgICAgbmF2aWdhdGUucHVzaCh0aGlzLmN1cnJlbnRQYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG5hdmlnYXRlLnB1c2godGhpcy5jb25maWcucmVkaXJlY3QucGFyYW0ucGFyYW1zW3BdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5yb3V0ZS5uYXZpZ2F0ZShuYXZpZ2F0ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIid1cmwnIHBhcmFtZXRlciBtdXN0IGJlIHNldCB3aXRoICdjb25maWcucmVkaXJlY3QnXCIpO1xuICAgICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgIH1cbiAgICAgIFxuICAgIH1cbiAgfVxuICAvKiBGdW5jdGlvbiBOYW1lIDogcmVkZWZpbmVQYWdlclxuXHQqIEF1dGhvciA6IFxuXHQqIENyZWF0ZWQgRGF0ZSA6IDA2LTAzLTIwMTkgXG5cdCogTW9kaWZpZWQgRGF0ZSA6ICpcblx0KiBQdXJwb3NlIDogdG8gY3JlYXRlIHBhZ2luYXRpb24gaHRtbFxuXHQqIFBBUkFNUyA6IFxuXHQqL1xuICByZWRlZmluZVBhZ2VyKCkge1xuICAgICAgdGhpcy5wYWdlcyA9IFtdO1xuICAgICAgdGhpcy5wYWdlcy5wdXNoKHRoaXMuY3VycmVudFBhZ2UpO1xuICAgICAgbGV0IGxlZnRDb3VudCA9IDA7XG4gICAgICBsZXQgcmlnaHRDb3VudCA9IDA7XG4gICAgICBpZiAodGhpcy5kaXNwbGF5UGFnZXNDb3VudCUyID09IDApIHsgLy8gaWYgZXZlbiBkaXNwbGF5IG51bWJlciBjb3VudFxuICAgICAgICBsZWZ0Q291bnQgPSBNYXRoLmZsb29yKHRoaXMuZGlzcGxheVBhZ2VzQ291bnQvMyk7IC8vIG9uZSB0aGFyZCBpbiBsZWZ0XG4gICAgICAgIHJpZ2h0Q291bnQgPSBNYXRoLmZsb29yKCh0aGlzLmRpc3BsYXlQYWdlc0NvdW50KjIpLzMpOyAvLyB0d28gdGhhcmQgaW4gcmlnaHRcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheVBhZ2VzQ291bnQlNiA9PSAwKSB7XG4gICAgICAgICAgbGVmdENvdW50IC09MTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHsgLy8gaWYgb2RkIGRpc3BsYXkgbnVtYmVyIGNvdW50IFxuICAgICAgICBsZWZ0Q291bnQgPSBNYXRoLmZsb29yKCh0aGlzLmRpc3BsYXlQYWdlc0NvdW50LTEpLzIpOyAvLyBoYWxmIGluIGxlZnRcbiAgICAgICAgcmlnaHRDb3VudCA9IE1hdGguZmxvb3IoKHRoaXMuZGlzcGxheVBhZ2VzQ291bnQtMSkvMik7IC8vIGhhbGYgaW4gcmlnaHRcbiAgICAgICAgXG4gICAgICB9XG4gICAgICBsZXQgbGVmdEFycj1bXSwgcmlnaHRBcnI9W107XG4gICAgICBmb3IgKGxldCBwPTE7IHA8PWxlZnRDb3VudDsgcCsrKSB7XG4gICAgICAgIGlmICgodGhpcy5jdXJyZW50UGFnZS1wKSA+IDAgKSB7XG4gICAgICAgICAgbGVmdEFyci5wdXNoKHRoaXMuY3VycmVudFBhZ2UtcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChsZWZ0QXJyLmxlbmd0aCA8IGxlZnRDb3VudCkge1xuICAgICAgICByaWdodENvdW50ICs9IGxlZnRDb3VudC1sZWZ0QXJyLmxlbmd0aDsgXG4gICAgICB9XG4gICAgICBmb3IgKGxldCBwPTE7IHA8PXJpZ2h0Q291bnQ7IHArKykge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZStwIDw9IHRoaXMudG90YWxQYWdlKSB7XG4gICAgICAgICAgcmlnaHRBcnIucHVzaCh0aGlzLmN1cnJlbnRQYWdlK3ApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocmlnaHRBcnIubGVuZ3RoIDwgcmlnaHRDb3VudCkge1xuICAgICAgICBsZWZ0Q291bnQgKz0gcmlnaHRDb3VudCAtIHJpZ2h0QXJyLmxlbmd0aCAgO1xuICAgICAgICBsZWZ0QXJyID0gW107XG4gICAgICAgIGZvciAobGV0IHA9MTsgcDw9bGVmdENvdW50OyBwKyspIHtcbiAgICAgICAgICBpZiAoKHRoaXMuY3VycmVudFBhZ2UtcCkgPiAwICkge1xuICAgICAgICAgICAgbGVmdEFyci5wdXNoKHRoaXMuY3VycmVudFBhZ2UtcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLnBhZ2VzID0gdGhpcy5wYWdlcy5jb25jYXQobGVmdEFycik7XG4gICAgICB0aGlzLnBhZ2VzID0gdGhpcy5wYWdlcy5jb25jYXQocmlnaHRBcnIpO1xuICAgICAgXG4gICAgICB0aGlzLnBhZ2VzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcblxuICB9XG5cblxuICByZW5kZXJpbmcoKSB7XG4gICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgdGhpcy5jb25maWcucmVuZGVyKHRoaXMuY3VycmVudFBhZ2UpO1xuICAgIH0sNSlcbiAgfVxufVxuIl19